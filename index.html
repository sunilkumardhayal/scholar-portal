<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Scholar Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // --- MASTER DATABASE ---
        const menuDB = {
            0: { day: "Sunday", breakfast: "Poha/Sprouts, Bread Butter Jam, Tea/Coffee", lunch: "Baingan Bharta, Dal Panchratni, Rice, Chapati", snacks: "Maggie/Red Sauce Pasta, Tea", dinner: "Dal Panchratni, Pulao, Chapati, Gulab Jamun" },
            1: { day: "Monday", breakfast: "Veg Cutlet, Sprouts, Bread Butter Jam, Tea/Coffee", lunch: "Tadka Dal, Maths Veg, Rice, Chapati", snacks: "Chocolate/Butter Maska Bun, Tea", dinner: "Dal Panchratni, Malai Kofta, Pulao, Chapati" },
            2: { day: "Tuesday", breakfast: "Aloo Onion Paratha, Curd, Tea/Coffee", lunch: "Lauki Chana Dal, Jeera Rice, Chapati", snacks: "Corn Chaat, Tea", dinner: "Khichdi Paneer, Chapati" },
            3: { day: "Wednesday", breakfast: "Uttapam, Sambar, Peanut Chutney, Tea/Coffee", lunch: "Arhar Dal, Soya Chunk Curry, Rice, Chapati", snacks: "Papdi Chaat, Tea", dinner: "Gobi Matar, Chapati" },
            4: { day: "Thursday", breakfast: "Poha, Sprouts, Bread Butter Jam, Tea/Coffee", lunch: "Paneer Matar, Moong Masala, Rice", snacks: "Aloo Tikki Burger, Tea", dinner: "Amritsari Dal, Cabbage Matar, Chapati" },
            5: { day: "Friday", breakfast: "Dosa, Sambar, Chutney, Tea/Coffee", lunch: "Aloo Palak, Plain Rice, Chapati", snacks: "Dabeli, Tea", dinner: "Rajsthani Dal, Paneer, Chapati" },
            6: { day: "Saturday", breakfast: "Idli, Sambar, Chutney, Tea/Coffee", lunch: "Aloo Sabzi, Jeera Rice, Chapati", snacks: "Veg Sandwich, Tea", dinner: "Rajsthani Kadi, Chapati" }
        };

        const busDB = [
            // Morning 56 Seater (IITGN to Kudasan)
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "07:00", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "07:30", type: "inbound" },
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "08:30", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "09:00", type: "inbound" },
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "09:30", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "10:00", type: "inbound" },
            // Evening 56 Seater
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "16:30", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "17:00", type: "inbound" },
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "17:45", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "18:15", type: "inbound" },
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "18:45", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "19:15", type: "inbound" },
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "19:45", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "20:15", type: "inbound" },
            { route: "IITGN Mess to Kudasan (56-Seater)", timeStr: "21:30", type: "outbound" },
            { route: "Kudasan to IITGN Mess (56-Seater)", timeStr: "22:30", type: "inbound" },
            // JEET 29-Seater (Sampled key times for brevity in logic)
            { route: "JEET to Mess (29-Seater)", timeStr: "08:20", type: "internal" },
            { route: "Mess to JEET (29-Seater)", timeStr: "08:40", type: "internal" },
            { route: "JEET to Mess (29-Seater)", timeStr: "09:00", type: "internal" },
            { route: "JEET to Mess (29-Seater)", timeStr: "13:00", type: "internal" },
            { route: "Mess to JEET (29-Seater)", timeStr: "13:20", type: "internal" },
            { route: "JEET to Mess (29-Seater)", timeStr: "18:00", type: "internal" },
            { route: "Mess to JEET (29-Seater)", timeStr: "18:20", type: "internal" },
            // EECO Shuttle
            { route: "EECO Shuttle (JEET to Mess)", timeStr: "07:50", type: "internal" },
            { route: "EECO Shuttle (Mess to JEET)", timeStr: "08:00", type: "internal" },
            { route: "EECO Shuttle (JEET to Mess)", timeStr: "10:00", type: "internal" }
        ];

        // --- CORE LOGIC ENGINE ---
        function format12Hour(timeStr) {
            let [hours, minutes] = timeStr.split(':');
            hours = parseInt(hours);
            let ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; 
            return `${hours}:${minutes} ${ampm}`;
        }

        function updateLiveDashboard() {
            const now = new Date();
            
            // 1. Update Live Watch (Time, Day, Date)
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            const dateString = `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
            
            document.getElementById('live-time').innerText = timeString;
            document.getElementById('live-date').innerText = dateString;

            // 2. Dynamic Meal Engine
            let currentHour = now.getHours();
            let todayData = menuDB[now.getDay()];
            let mealName = "";
            let mealContent = "";

            if (currentHour < 10) {
                mealName = "Breakfast (Upcoming/Active)";
                mealContent = todayData.breakfast;
            } else if (currentHour < 15) {
                mealName = "Lunch (Upcoming/Active)";
                mealContent = todayData.lunch;
            } else if (currentHour < 18) {
                mealName = "Snacks (Upcoming/Active)";
                mealContent = todayData.snacks;
            } else if (currentHour < 22) {
                mealName = "Dinner (Upcoming/Active)";
                mealContent = todayData.dinner;
            } else {
                mealName = "Breakfast (Tomorrow)";
                let tomorrow = (now.getDay() + 1) % 7;
                mealContent = menuDB[tomorrow].breakfast;
            }

            document.getElementById('dynamic-meal-name').innerText = `Next Meal: ${todayData.day} ${mealName}`;
            document.getElementById('dynamic-meal-content').innerText = mealContent;

            // 3. Dynamic Transit Engine
            let currentMinutesSinceMidnight = (now.getHours() * 60) + now.getMinutes();
            
            let upcomingBuses = busDB.filter(bus => {
                let [h, m] = bus.timeStr.split(':');
                let busMinutes = (parseInt(h) * 60) + parseInt(m);
                return busMinutes >= currentMinutesSinceMidnight;
            }).sort((a, b) => {
                let [h1, m1] = a.timeStr.split(':');
                let [h2, m2] = b.timeStr.split(':');
                return ((parseInt(h1)*60)+parseInt(m1)) - ((parseInt(h2)*60)+parseInt(m2));
            }).slice(0, 4); // Get next 4 buses

            let busHTML = '';
            if(upcomingBuses.length === 0) {
                busHTML = '<li class="p-3 text-gray-500">No more buses scheduled for today.</li>';
            } else {
                upcomingBuses.forEach(bus => {
                    let color = bus.type === 'internal' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800';
                    busHTML += `
                    <li class="flex justify-between items-center bg-gray-50 p-3 rounded border border-gray-100 mb-2">
                        <span class="block font-bold text-gray-800">${bus.route}</span>
                        <span class="${color} font-bold text-sm px-3 py-1 rounded-full">${format12Hour(bus.timeStr)}</span>
                    </li>`;
                });
            }
            document.getElementById('dynamic-bus-list').innerHTML = busHTML;
        }

        // --- TAB NAVIGATION ---
        function switchTab(tabId) {
            document.getElementById('live-dash').classList.add('hidden');
            document.getElementById('full-menu').classList.add('hidden');
            document.getElementById(tabId).classList.remove('hidden');
            
            document.getElementById('tab-live').classList.remove('border-blue-500', 'text-blue-600');
            document.getElementById('tab-menu').classList.remove('border-blue-500', 'text-blue-600');
            
            if(tabId === 'live-dash') {
                document.getElementById('tab-live').classList.add('border-blue-500', 'text-blue-600');
            } else {
                document.getElementById('tab-menu').classList.add('border-blue-500', 'text-blue-600');
                populateFullMenu();
            }
        }

        function populateFullMenu() {
            let menuHTML = '';
            for(let i=0; i<7; i++) {
                let d = menuDB[i];
                menuHTML += `
                <div class="mb-4 p-4 border rounded bg-gray-50">
                    <h3 class="font-bold text-lg text-blue-900 border-b pb-2 mb-2">${d.day}</h3>
                    <p><strong class="text-gray-700">Breakfast:</strong> ${d.breakfast}</p>
                    <p><strong class="text-gray-700">Lunch:</strong> ${d.lunch}</p>
                    <p><strong class="text-gray-700">Snacks:</strong> ${d.snacks}</p>
                    <p><strong class="text-gray-700">Dinner:</strong> ${d.dinner}</p>
                </div>`;
            }
            document.getElementById('full-menu-container').innerHTML = menuHTML;
        }

        window.onload = function() {
            updateLiveDashboard();
            setInterval(updateLiveDashboard, 1000); // Update clock every second
            switchTab('live-dash');
        }
    </script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans pb-10">
    
    <nav class="bg-blue-900 text-white p-4 shadow-md sticky top-0 z-50 flex justify-between items-center">
        <h1 class="text-2xl font-bold tracking-wide">The Scholar Portal</h1>
        <div class="text-right">
            <div id="live-time" class="text-xl font-mono font-bold text-yellow-300">Loading...</div>
            <div id="live-date" class="text-xs text-blue-200">Loading...</div>
        </div>
    </nav>

    <div class="container mx-auto p-4 mt-4 max-w-5xl">
        <div class="flex border-b mb-6 border-gray-300">
            <button id="tab-live" onclick="switchTab('live-dash')" class="py-2 px-4 border-b-2 font-semibold text-blue-600 border-blue-500">Live Dashboard</button>
            <button id="tab-menu" onclick="switchTab('full-menu')" class="py-2 px-4 border-b-2 font-semibold text-gray-500 border-transparent">Full Week Mess Menu</button>
        </div>

        <div id="live-dash" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <div class="flex items-center mb-4">
                    <span class="bg-red-500 w-3 h-3 rounded-full animate-pulse mr-2"></span>
                    <h2 class="text-xl font-bold text-gray-700">Dining Status</h2>
                </div>
                <div class="p-4 bg-orange-50 rounded border border-orange-200">
                    <h3 id="dynamic-meal-name" class="font-bold text-orange-900 mb-2 text-lg">Calculating...</h3>
                    <p id="dynamic-meal-content" class="text-gray-800 font-medium">Loading upcoming menu...</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <div class="flex items-center mb-4">
                    <span class="bg-green-500 w-3 h-3 rounded-full animate-pulse mr-2"></span>
                    <h2 class="text-xl font-bold text-gray-700">Next Available Transit</h2>
                </div>
                <ul id="dynamic-bus-list" class="space-y-2">
                    <li class="p-3 text-gray-500">Scanning schedules...</li>
                </ul>
            </div>
        </div>

        <div id="full-menu" class="hidden">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Complete Weekly Menu</h2>
                <div id="full-menu-container">
                    </div>
            </div>
        </div>
        
    </div>
</body>
</html>
